<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin | Quote Requests</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: Inter, sans-serif;
  background: #f8fafc;
  overflow: hidden;
}

.admin-layout {
  min-height: 100vh;
}


/* SIDEBAR */
.sidebar {
  width: 260px;
  background: #0f172a;
  color: #fff;
  display: flex;
  flex-direction: column;

  position: fixed;     /* ðŸ”¥ IMPORTANT */
  top: 0;
  left: 0;
  height: 100vh;       /* full screen height */
  z-index: 100;
}


.sidebar-logo {
  padding: 20px;
  font-weight: 700;
  font-size: 18px;
  border-bottom: 1px solid #1e293b;
}

.sidebar-nav a {
  padding: 14px 20px;
  display: block;
  color: #cbd5f5;
  text-decoration: none;
  font-weight: 500;
}

.sidebar-nav a:hover,
.sidebar-nav a.active {
  background: #1e293b;
  color: #fff;
}

.sidebar-footer {
  padding: 20px;
  border-top: 1px solid #1e293b;
  background: #0f172a;
}
.sidebar-nav {
  flex: 1;               /* ðŸ”¥ pushes footer down */
  overflow-y: auto;      /* ðŸ”¥ scroll inside sidebar */
}


.sidebar-footer button {
  width: 100%;
}

/* MAIN */
.admin-main {
  margin-left: 260px;                 /* sidebar width */
  width: calc(100vw - 260px);         /* ðŸ”¥ IMPORTANT */
  height: 100vh;
  overflow-y: auto;
  padding: 24px;
  background: #f8fafc;
  box-sizing: border-box;
  scrollbar-gutter: stable;
}



.admin-top {
  margin-bottom: 24px;
}

.admin-top h1 {
  margin: 0;
  font-size: 22px;
}

.admin-top p {
  margin-top: 6px;
  color: #64748b;
  font-size: 14px;
}

/* QUOTE CARD */
.quote-card {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.05);
  margin-bottom: 20px;
}

.quote-card h3 {
  margin-top: 0;
}

.quote-card p {
  margin: 6px 0;
  font-size: 14px;
}

select {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.actions {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}

.btn-primary {
  background: #2563eb;
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
}

.btn-outline {
  background: transparent;
  border: 1px solid #2563eb;
  color: #2563eb;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
}
</style>
</head>

<body>

<div class="admin-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">GLOBAL BARITE</div>

    <nav class="sidebar-nav">
      <a href="dashad7r.html">Dashboard</a>
      <a href="gb-admin-9x2k.html" class="active">Quote Requests</a>
      <a href="contact7xad.html">Contact Inquiries</a>
      <a href="users7xad.html">Users</a>
    </nav>

    <div class="sidebar-footer">
      <button id="logoutBtn" class="btn-outline">Logout</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="admin-main">

    <div class="admin-top">
      <h1>Quote Requests</h1>
      <p>Manage and respond to customer quote inquiries</p>
    </div>

    <div id="quotesList"></div>

  </main>

</div>

<script type="module">
import { auth, db } from "./assets/js/firebase.js";
import { onAuthStateChanged, signOut } from
  "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import {
  collection,
  getDocs,
  orderBy,
  query,
  updateDoc,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const quotesList = document.getElementById("quotesList");
const logoutBtn = document.getElementById("logoutBtn");

// ðŸ” ADMIN CHECK
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const snap = await getDoc(doc(db, "users", user.uid));
  if (!snap.exists() || snap.data().role !== "admin") {
    alert("Access denied");
    window.location.href = "index.html";
    return;
  }

  loadQuotes();
});

// ðŸšª LOGOUT
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "login.html";
});

// ðŸ“¦ LOAD QUOTES
async function loadQuotes() {
  const q = query(
    collection(db, "quotes"),
    orderBy("createdAt", "desc")
  );

  const snap = await getDocs(q);

  if (snap.empty) {
    quotesList.innerHTML =
      "<p style='color:#64748b'>No quote requests found.</p>";
    return;
  }

  quotesList.innerHTML = "";

  snap.forEach(docSnap => {
    const d = docSnap.data();

    quotesList.innerHTML += `
      <div class="quote-card">
        <h3>${d.product}</h3>

        <p><strong>Company:</strong> ${d.company}</p>
        <p><strong>Contact:</strong> ${d.name}</p>
        <p><strong>Email:</strong> ${d.email}</p>
        <p><strong>Phone:</strong> ${d.phone}</p>
        <p><strong>Quantity:</strong> ${d.quantity} MT</p>
        <p><strong>Country:</strong> ${d.country}</p>

        <label><strong>Status</strong></label><br>
        <select onchange="updateStatus('${docSnap.id}', this.value)">
          <option ${d.status==="new"?"selected":""}>new</option>
          <option ${d.status==="reviewing"?"selected":""}>reviewing</option>
          <option ${d.status==="contacted"?"selected":""}>contacted</option>
          <option ${d.status==="closed"?"selected":""}>closed</option>
        </select>

        <div class="actions">
          <a class="btn-outline"
             href="mailto:${d.email}?subject=Quote Update - Global Barite">
             Email
          </a>

          <a class="btn-primary"
             target="_blank"
             href="https://wa.me/91${d.phone}">
             WhatsApp
          </a>
        </div>
      </div>
    `;
  });
}

// ðŸ” UPDATE STATUS
window.updateStatus = async (id, status) => {
  await updateDoc(doc(db, "quotes", id), { status });
  alert("Status updated");
};
</script>

</body>
</html>
