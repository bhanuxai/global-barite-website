<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forgot Password | Global Barite</title>

<link rel="stylesheet" href="assets/css/style.css">

<style>
  .msg {
    margin-top: 16px;
    font-size: 14px;
    text-align: center;
    display: none;
  }
  .msg.success {
    color: #22c55e;
  }
  .msg.error {
    color: #ef4444;
  }
</style>
</head>

<body class="auth-body">

<section class="auth-section">
  <div class="auth-card">

    <h1>Forgot Password</h1>
    <p class="auth-subtext">
      Enter your registered email to receive a reset link
    </p>

    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="resetEmail" placeholder="you@example.com" required>
    </div>

    <button id="sendResetBtn" class="btn-primary full-width">
      Send Reset Link
    </button>

    <!-- MESSAGE AREA -->
    <div id="successMsg" class="msg success">
      ✅ Password reset link sent. Please check your email.
    </div>

    <div id="errorMsg" class="msg error">
      ❌ This email is not registered.
    </div>

    <div class="auth-footer">
      <a href="login.html">Back to Login</a>
    </div>

  </div>
</section>

<script type="module">
  import { auth } from "./assets/js/firebase.js";
  import { sendPasswordResetEmail } from
    "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  const btn = document.getElementById("sendResetBtn");
  const emailInput = document.getElementById("resetEmail");
  const successMsg = document.getElementById("successMsg");
  const errorMsg = document.getElementById("errorMsg");

  btn.addEventListener("click", async () => {
    const email = emailInput.value.trim();

    successMsg.style.display = "none";
    errorMsg.style.display = "none";

    if (!email) {
      errorMsg.innerText = "❌ Please enter your email address";
      errorMsg.style.display = "block";
      return;
    }

    const actionCodeSettings = {
      url: "https://global-barite.web.app/reset-password.html",
      handleCodeInApp: true
    };

    try {
      await sendPasswordResetEmail(auth, email, actionCodeSettings);

      successMsg.style.display = "block";
      emailInput.value = "";
    } catch (err) {
      if (err.code === "auth/user-not-found") {
        errorMsg.innerText = "❌ Email not found. Please check and try again.";
      } else if (err.code === "auth/invalid-email") {
        errorMsg.innerText = "❌ Invalid email format.";
      } else {
        errorMsg.innerText = "❌ Something went wrong. Try again later.";
      }
      errorMsg.style.display = "block";
    }
  });
</script>

</body>
</html>
